pipeline {
  agent {
    node {
        label 'jenkins-agent'
    }
  }
  stages {
    stage('checkout') {
      steps {
        git(
          branch: 'ci',
          credentialsId: 'jenkins-rsa',
          url: 'git@github.com:renatus-cartesius/jenkins-testing.git'
        )
      }
    }

    stage('timestamp to log'){
      steps{
        sh 'git checkout main'
        sh 'echo "`date +%F-%T` PRjob executed" > job.log'
        sh 'git add .'
        sh 'git commit -m "updated time stamp, `date +%F-%T`"'
      }
    }

    stage('push to repo'){
      steps {
        withCredentials([sshUserPrivateKey(credentialsId: 'jenkins-rsa', keyFileVariable: 'SSH_KEY')]) {
          sh 'GIT_SSH_COMMAND="ssh -i $SSH_KEY" git push origin main'
        }
      }
    }
  }
  post {
    always {
      emailext body: 'Test Message',
        subject: 'Test Subject',
        to: 'cartesius.absolute@gmail.com'
    }
  }
}
